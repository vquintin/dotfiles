syntax on
filetype on
set expandtab
set tabstop=4
set softtabstop=0
set shiftwidth=4
set smarttab
set autoindent
set smartindent
set smartcase
set ignorecase
set modeline
set nocompatible
set encoding=utf-8
set incsearch
set hlsearch
set history=700
set relativenumber
set laststatus=2
set cursorline
set cursorcolumn

set hidden

" save on close
set autowrite

set ruler

set confirm

set visualbell

set background=light
let g:solarized_termcolors=256
let g:solarized_contrast="high"
let g:solarized_visibility="high"
colorscheme solarized
let g:airline_theme = 'molokai'

let mapleader = "ç"

" CTRL-P
set grepprg=rg\ --vimgrep
" bind K to grep word under cursor
nnoremap K :grep! "\b<C-R><C-W>\b"<CR>:cw<CR>

let g:ctrlp_user_command = 'rg --files %s'
let g:ctrlp_use_caching = 0

" Error and warning signs.

let g:ale_linters = {
\   'haskell': [],
\}

let g:ale_sign_error = '⤫'
let g:ale_sign_warning = '⚠'

" LSP

nnoremap <silent> <leader>K :LspHover<CR>
nnoremap <silent> gd :LspDefinition<CR>
nnoremap <silent> <F2> :LspRename<CR>

if executable('hie')
    au User lsp_setup call lsp#register_server({
      \ 'name': 'hie',
      \ 'cmd': {server_info->['hie-8.2', '--ekg', '--lsp']},
      \ 'whitelist': ['haskell'],
      \ })
endif

" Nerd tree
silent! map <F2> :NERDTreeToggle<CR>
silent! map <F3> :NERDTreeFind<CR>
let g:NERDTreeMapOpenInTab="h"
let g:NERDTreeMapOpenInTabSilent="H"
let g:NERDTreeMapOpenVSplit="k"
let g:NERDTreeMapJumpFirstChild="S"
let g:NERDTreeMapJumpLastChild="T"
let g:NERDTreeMapJumpNextSibling="<C-T>"
let g:NERDTreeMapJumpPrevSibling="<C-S>"
let g:NERDTreeMapChangeRoot="L"
let g:NERDTreeMapRefresh="j"
let g:NERDTreeMapRefreshRoot="J"
let g:NERDTreeToggle="<F2>"
let g:NERDTreeMapActivateNode="<F3>"
let g:NERDTreeMapPreview="<F4>"

" Enable integration with airline.
let g:airline#extensions#ale#enabled = 1

let g:go_highlight_build_constraints = 1
let g:go_highlight_extra_types = 1
let g:go_highlight_fields = 1
let g:go_highlight_functions = 1
let g:go_highlight_methods = 1
let g:go_highlight_operators = 1
let g:go_highlight_structs = 1
let g:go_highlight_types = 1

" let g:go_fmt_command = "goimports"

autocmd FileType go nmap <leader>b  <Plug>(go-build)
autocmd FileType go nmap <leader>r  <Plug>(go-run)
autocmd FileType go nmap <leader>t  <Plug>(go-test)
autocmd FileType go nmap <Leader>c  <Plug>(go-coverage-toggle)


let g:elm_format_autosave = 1

" Configure haskell extensions
autocmd FileType haskell nmap <silent> <leader>e :GhcModTypeInsert<CR>
autocmd FileType haskell nmap <silent> <leader>s :GhcModSplitFunCase<CR>
autocmd FileType haskell nmap <silent> <leader>i :GhcModType<CR>
autocmd FileType haskell nmap <silent> <leader>c :GhcModTypeClear<CR>
autocmd FileType haskell nmap <silent> <leader>g :GhcModSigCodegen<CR>

" Scala
autocmd FileType scala nmap <silent> <leader>h :EnType<CR>
autocmd BufWritePost *.scala silent :EnTypeCheck
